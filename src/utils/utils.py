def merge_results(result1, result2):
    """
    Merge two dictionaries to one. It merges the values of the same tag.
    The format of the dictionaries is:
        {filename: {tag1: [..], tag2: [..],}
    :param result1: A dictionary to merge.
    :param result2: A dictionary to merge.
    :return: The merged result dictionary.
    """
    merge = {}
    # we know that every filename is represented in both dictionaries
    for filename, info_dict1 in result1.items():
        merge.setdefault(filename, {})
        info_dict2 = result2[filename]
        # param := cve, ip, ...
        # val1/val2 := list of values to the param
        for param, val1 in info_dict1.items():
            val2 = info_dict2.get(param, [])
            val1_set = set(val1)
            merge_dict = merge.setdefault(filename, {})
            merge_dict[param] = list(val1_set.union(val2))
        for param, val2 in info_dict2.items():
            val1 = info_dict1.get(param, [])
            val2_set = set(val2)
            merge_dict = merge.setdefault(filename, {})
            merge_dict[param] = list(val2_set.union(val1))

    return merge


def del_multiple_emails(all_results):
    """
    Deletes multiple emails from additional_emails tag, if the emails are
    already in email-tag.
    :param all_results: A dictionary object to delete multiple emails.
    """
    for values in all_results.values():
        add_mails = values.get('additional_emails', [])
        # with slice notion we can delete items while iterating
        for mail in add_mails[:]:
            email = values.get('email', [])
            if mail in email:
                add_mails.remove(mail)


def del_multiple_urls(all_results):
    """
    Deletes multiple urls from additional_urls tag, if the urls are
    already in another tag.
    :param all_results: A dictionary object to delete multiple urls.
    The format of the dictionary is:
        {filename: {tag1: [..], tag2: [..],}
    """
    for filename, values in all_results.items():
        tags = list(values.keys())
        if 'additional_urls' in tags:
            tags.remove('additional_urls')
            for tag in tags:
                val = values.get(tag, [])
                add_urls = values.get('additional_urls', [])
                # with slice notion we can delete items while iterating
                for url in add_urls[:]:
                    if url in val:
                        add_urls.remove(url)
